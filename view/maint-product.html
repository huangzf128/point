{% extends "layout.html" %}

{% block style %}
body {
	background-color: lightblue;
}
{% endblock %}


{% block content %}
<div class="container" style="margin-top:65px">
	<!--jumbutron start-->
	<div class="jumbotron text-center">
		<h1>商品管理</h1>
	</div>
	<!--jumbutron ends-->
	<!--breadcrumb start-->
	<nav aria-label="breadcrumb">
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="/maint">管理TOP</a></li>
			<li class="breadcrumb-item active" aria-current="page">{{ categoryName }}</li>
		</ol>
	</nav>
	<!--breadcrumb end-->
	<hr />
	<!--menu list-->

	<div>
		{% for product in products %}
		{% if product.row_number == 1 %}
			</div>
			<div class="row text-center" id="{{ category_id }}">
		{% endif %}

		<div class="col-md-3 col-6 py-3">
			<div class="card">
				<a href="detail?categoryid={{ category_id }}&itemid={{ product.id }}">
					<img src="{{ product.image }}" alt="" class="img-fluid pb-1">
				</a>
				<div class="figure-caption">
					<h6 class="fw-bolder">{{ product.name }}</h6>
					<h6>価格: {{ product.price|number_format(0, '.', ',')  }} (税込)</h6>

					<p>
						<a name="link_modify" href="#" pid="{{ product.id }}">
							<span>情報変更 </span>
							<i class="fa-solid fa-pen-to-square"></i>
						</a>
						<a class="ms-4" delete href="maint-product-delete?cId={{ category_id }}&id={{ product.id }}">
							<i class="fa-solid fa-trash-can"></i>
						</a>
						<input type="hidden" name="name" value="{{ product.name }}" />
						<input type="hidden" name="maker" value="{{ product.maker }}" />
						<input type="hidden" name="price" value="{{ product.price }}" />
						<input type="hidden" name="size" value="{{ product.size }}" />
						<input type="hidden" name="weight" value="{{ product.weight }}" />
						<input type="hidden" name="introduction" value="{{ product.introduction }}" />
					</p>

				</div>
			</div><!-- end card -->
		</div>
		{% endfor %}

		<div class="col-md-3 col-6 py-3">
			<div class="card">
				<br/><br/>
				<a id="link_add" href="#" class="align-middle h1">
					<i class="fa-regular fa-square-plus text-primary"></i>
				</a>
				<br/>
				商品追加
			</div>
		</div>		
	
	</div>

<br/><br/><br/>
</div><!-- end container -->

<!--商品管理 trigger Modal-->
<div class="modal fade" id="product_maint" aria-labelledby="staticBackdropLabel">
	<div class="modal-dialog modal-dialog-centered modal-lg">
		<div class="modal-content" style="background-color:rgba(255,255,255,0.95)">
			<div class="modal-header">
				<h5 class="modal-title" id="staticBackdropLabel">商品管理</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
				</button>
			</div>

			<div class="modal-body">
				<form action="maint-product-add" method="post" enctype="multipart/form-data">
					<input type="hidden" id="cid" name="cid" value="{{ category_id }}" />
					<input type="hidden" id="pid" name="pid" />
					<div class="row col py-3">
						<label id="modal-title" for="formFileLg" class="form-label float-start">商品画像</label>
						<input class="form-control form-control-sm" id="formFileLg" type="file"  name="image[]" />
						<input class="form-control form-control-sm" id="formFileLg" type="file"  name="image[]" />
						<input class="form-control form-control-sm" id="formFileLg" type="file"  name="image[]" />
					</div>
					<div class="row">
						<div class="col-md-6 py-3 row">
							<label for="name" class="form-label float-start">商品名</label>
							<input type="text" class="form-control" id="name" name="name" placeholder="" required><br/>

							<label for="prce" class="form-label float-start">メーカー</label>
							<input type="text" class="form-control" id="maker" name="maker" placeholder="" ><br/>

							<label for="prce" class="form-label float-start">価格</label>
							<input type="text" class="form-control" id="price" name="price" placeholder="" required><br/>

							<div class="col-md-6">
								<label for="prce" class="form-label float-start">重量</label>
								<input type="text" class="form-control" id="weight" name="weight" placeholder="" ><br/>
							</div>
							<div class="col-md-6">
								<label for="prce" class="form-label float-start">サイズ</label>
								<input type="text" class="form-control" id="size" name="size" placeholder="" ><br/>
							</div>

							<button class="btn btn-primary btn-block float-start">更新</button>
						</div>
						<div class="col-md-6 py-3">
							<label for="prce" class="form-label float-start">説明</label>
							<textarea type="text" rows="10" class="form-control" id="introduction" name="introduction" placeholder="" ></textarea>
							<br/>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!--商品管理 trigger Model ends-->	
{% endblock %}

{% block script %}

$(".modal").on("shown.bs.modal", function(){
	if ($('#pid').val()) {
		$('h5#staticBackdropLabel').text("商品変更");
	} else {
		$('h5#staticBackdropLabel').text("商品追加");
		$('#pid').val('');
	}
});

$('.modal').on('hidden.bs.modal', function () {
    $(this).find('form').trigger('reset');
});

$('#link_add').click(function(){
	$('#product_maint').modal('show');
});

$('a[name=link_modify]').click(function(){
	$('#pid').val($(this).attr('pid'));

	let p = $(this).parent();

	$('#name').val(p.find("input[name=name]").eq(0).val());
	$('#maker').val(p.find("input[name=maker]").eq(0).val());
	$('#price').val(p.find("input[name=price]").eq(0).val());
	$('#weight').val(p.find("input[name=weight]").eq(0).val());
	$('#size').val(p.find("input[name=size]").eq(0).val());
	$('#introduction').val(p.find("input[name=introduction]").eq(0).val());
	
	$('#product_maint').modal('show');
});


$('a[delete]').on('click', function () {
	return confirm('商品を削除します。よろしいですか?');
});

{% endblock %}
